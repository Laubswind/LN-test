# LND Manager 启动和测试指南

## 🚀 快速启动

### 1. 启动开发服务器

```bash
npm run dev
```

这会启动开发服务器，支持热重载，服务将运行在 `http://localhost:3000`

### 2. 或者运行生产模式

```bash
npm start
```

## 🧪 API 测试

服务启动后，你可以通过以下方式测试 API：

### 方法 1: 使用提供的测试脚本

```bash
node test-api.js
```

### 方法 2: 使用 curl 命令测试

#### 健康检查

```bash
curl http://localhost:3000/health
```

#### 获取 LND 节点信息

```bash
curl http://localhost:3000/api/lnd/info
```

#### 获取节点余额

```bash
curl http://localhost:3000/api/lnd/balance
```

#### 获取通道列表

```bash
curl http://localhost:3000/api/lnd/channels
```

#### 创建发票

```bash
curl -X POST http://localhost:3000/api/lnd/invoice \
  -H "Content-Type: application/json" \
  -d '{"amount": "1000", "memo": "测试发票"}'
```

## ⚙️ 配置说明

### 环境变量配置

如果你需要自定义配置，可以创建 `.env` 文件：

```env
# LND gRPC 配置
LND_GRPC_HOST=127.0.0.1
LND_GRPC_PORT=10009

# LND REST 配置
LND_REST_HOST=127.0.0.1
LND_REST_PORT=8080

# LND 证书和macaroon路径 (可选)
# LND_CERT_PATH=~/.lnd/tls.cert
# LND_MACAROON_PATH=~/.lnd/data/chain/bitcoin/mainnet/admin.macaroon

# Bitcoin Core RPC 配置
BITCOIND_RPC_USER=你的比特币节点用户名
BITCOIND_RPC_PASS=你的比特币节点密码

# 服务器端口
PORT=3000
```

### 默认配置

如果不提供环境变量，系统将使用以下默认配置：

- LND gRPC: `127.0.0.1:10009`
- LND REST: `127.0.0.1:8080`
- 证书路径: `~/.lnd/tls.cert`
- Macaroon 路径: `~/.lnd/data/chain/bitcoin/mainnet/admin.macaroon`
- 服务端口: `3000`

## 🔧 故障排除

### 常见问题

1. **LND 连接失败**

   - 确保 LND 节点正在运行
   - 检查证书和 macaroon 文件路径是否正确
   - 确认 LND 的 gRPC 端口配置

2. **端口占用**

   - 检查 3000 端口是否被其他程序占用
   - 可以通过环境变量 `PORT` 修改端口

3. **权限问题**
   - 确保有读取 LND 证书和 macaroon 文件的权限

## 📝 可用的 API 端点

- `GET /health` - 健康检查
- `GET /api/lnd/info` - 获取 LND 节点信息
- `GET /api/lnd/balance` - 获取节点余额
- `GET /api/lnd/channels` - 获取通道列表
- `POST /api/lnd/invoice` - 创建发票 (需要 body: {amount, memo})

## 🎯 下一步

1. 确保你的 LND 节点正在运行
2. 根据需要调整配置
3. 启动服务
4. 运行测试脚本验证功能
